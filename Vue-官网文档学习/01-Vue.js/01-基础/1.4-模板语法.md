# 1.4 模板语法

## 目录(Catalog)
- 1.4 模板语法
    + 1.4.1 插值
        - 1.4.1.1 文本 
        - 1.4.1.2 原始 `HTML`
        - 1.4.1.3 `Attribute`
        - 1.4.1.4 使用 `JavaScript` 表达式
    + 1.4.2 指令
        - 1.4.2.1 参数 
        - 1.4.2.2 动态参数
        - 1.4.2.3 修饰符
    + 1.4.3 缩写
        - 1.4.3.1 `v-bind` 缩写
        - 1.4.3.2 `v-on` 缩写

## 生词(New Words)


## 内容(Content)
### 1.4 模板语法
- Vue.js 使用基于 HTML 的模板语法, 它允许你声明式地将渲染的 DOM 绑定至底层 Vue
  实例的数据(Note: 通俗的理解: 要渲染的 DOM 都是建立在 Vue 实例的数据之上的).
  所有 Vue.js 的模板都是合法的 HTML, 所以能被遵循规范的浏览器和 HTML 解析器解析.
  
  在底层的实现上, Vue 将模板编译成虚拟 DOM 渲染函数. 结合响应系统,
  Vue 能够智能地计算出最少需要重新渲染多少组件, 并把 DOM 操作次数减到最少. 

  如果你熟悉虚拟 DOM 并且偏爱 JavaScript 的原始力量, 你也可以不用模板,
  直接写 `渲染(render)函数`(`./04-可复用性与组合.md` - `4.3 渲染函数 & JSX`),
  使用可选的 JSX 语法. 

##### 1.4.1 插值
- 1.4.1.1 文本
    + 数据绑定最常见的形式就是使用 `Mustache`(胡子)语法(双大括号)的文本插值:
      ```vue
        <span>Message: {{ msg }}</span>
      ```
      Mustache 标签将会被 Vue 实例中对应数据上的 `msg` 属性的值所替换. 无论何时,
      绑定的数据对象上的 `msg` 属性只要发生了改变, 插值出的内容也会立即发生改变.

      通过使用 [`v-once`指令](https://cn.vuejs.org/v2/api/#v-once),
      你也能执行一次性的插值, 当数据改变时, 插值处的内容不会更新.
      但请留心这会影响到该节点上的其它数据绑定:
      ```vue    
        <span v-once>这个将不会改变: {{ msg }}}</span>
      ```
- 1.4.1.2 原始 `HTML`
- 双大括号会将数据解释为普通文本, 而非 HTML 代码. 为了输出真正的 HTML, 你需要使用
  [`v-html`指令](https://cn.vuejs.org/v2/api/#v-html):
  ```vue
    // - 示例: `../../vue-document-learning-example/src/components/1.4.1.2.vue`
    <template>
        <div id="app-1412" class="default-div">
            <h2>1.4.1.2: 原始 HTML</h2>
            <p>使用 Mustache: {{rawHtml}}</p>
            <p>使用 v-html 指令: <span v-html="rawHtml"></span></p>
        </div>
    </template>

    <script>
        export default {
            name: 'app-1412',
            data() {
                return {
                    rawHtml: '<span style="color:red">This should be red.</span>'
                }
            }
        }
    </script>
  ```
- **Warning**: 你的站点上动态渲染的任意 HTML 可能都会非常危险, 因为它很容易导致
  [XSS 攻击](https://www.wikiwand.com/zh/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC).
  请只对可信任内容使用 HTML 插值, **绝不要**对用户提供的内容使用插值.
- 1.4.1.3 `Attribute`(特性)
    + Mustache 语法不能作用在 HTML attribute 上, 遇到这种情况应该使用 `v-bind` 指令:
      ```vue
        <div v-bind:id="dynamicId"></div>
      ```
      对于布尔 attribute(默认: 它们只要存在就意味着为 `true`), `v-bind`
      工作起来略有不同, 看下这个例子:
      ```vue
        <button v-bind:disabled="isButtonDisabled">Button</button>
      ```
      如果 `isButtonDisabled` 的值是 `null`, `undefined` 或 `false`, 则
      `disabled` 属性甚至不会被包含在渲染出来的 `<button>` 元素中.
- 1.4.1.4 使用 `JavaScript` **表达式**
    + **Added**: 表达式是什么?
        - (1) [MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Expressions_and_Operators)
          文档给出的回答是: 表达式是一组代码的集合,它返回一个值.
          每个合法的表达式都能计算成某个值. 例如:

          `x = 7` 是一个表达式, 该表达式使用 `=` 运算符将值 7 赋值给变量 `x`.
          这个表达式自己的值等于 7.
          
          `3 + 4` 也是一个表达式, 该表达式使用 `+` 运算符把 3 和 4 加到一起,
          但并没有把结果 7 赋值给一个变量.

          JavaScript 有一下表达式类型:
            + <1> 算数: 得出一个数字, 例如: 3.14159.
            + <2> 字符串: 得出一个字符串. 例如: 'Fred' 或 '234'.
            + <3> 逻辑值: 得出 `true` / `false`.
            + <4> 基本表达式: JS 中基本的关键字和一般表达式.
                - Q: JS 的基本关键字是可以查到, 但 "一般表达式" 是什么鬼?
            + <5> 左值表达式: 分配给左值.
                - Q: 这个左值表达式是指 `=`(赋值操作符)? 这文档写的是给人看的吗? 
        - (2) 第一种 MDN 给出的解释有点杂乱, 所以我添加上之前在
          `《C++ Primer》` 中看到的对 "表达式" 下的定义:
            + 表达式(expression): 在 C++ 中, 一个表达式产生一个计算结果,
              它由一个或多个运算对象和(通常是)一个运算符组成. (是不是清晰很多!!!)
    + 迄今为止, 在我们的模板中, 我们一直都只绑定简单的属性键值. 但实际上,
      对于所有的数据绑定, Vue.js 都提供了完全的 JavaScript 表达式支持. 例如:
      ```vue
        <!--(1)-->
        {{ number + 1 }}

        <!--(2)-->
        {{ ok ? 'YES' : 'NO' }}

        <!--(3)-->
        {{ message.split('').reverse().join('') }}

        <!--(4)-->
        <div v-bind:id="'list-' + id"></div>
      ```
      这些表达式会在所属 Vue 实例的数据作用域下作为 JavaScript 被解析. 有个限制是,
      每个绑定都只能包含 **单个表达式**, 所以下面的例子都不会生效.
      ```vue
        <!--这是语句, 不是表达式-->
        {{ var a = 1 }}

        <!--流控制语句也不会生效, 请使用三元表达式(三目运算符)-->
        {{ if(ok){return message }}
      ```
    + **Warning**: 模板表达式都被放在沙盒中, 只能访问
      [全局变量的一个白名单](https://github.com/vuejs/vue/blob/v2.6.10/src/core/instance/proxy.js#L9),
      如 `Math` 和 `Date`. 你不应该在模板表达式中试图访问用户定义的全局变量.
##### 1.4.2 指令
- `指令(Directives)` 是带有 `v-` 前缀的特殊 attribute. 指令 attribute
  的预期值是 **单个 JavaScript 表达式** (`v-for` 是例外情况, 稍后我们再讨论).
  指令的职责是, 当表达式的值改变时, 当其产生的连带影响, 响应式地作用于 DOM.
  回顾我们在介绍中看到的例子:
  ```vue
    <p v-if="seen">现在你看到我了</p>
  ```
  这里, `v-if` 指令将给句表达式 `seen` 值的真假来插入/移除 `<p>` 元素.
  
  **Added**: 注意这里的 **插入/移除 `<p>` 元素**,
  Vue 从新编译后确实是把 `<p>` 元素从页面中移除了而不是隐藏,
  在下面的文档中会讲 `v-show`指令(`1.7.2 v-show`), `v-show` 才是把元素隐藏.)
- 1.4.2.1 参数
    + 一些指令(directives)能够接受一个 "参数", 在指令名称之后以冒号表示.
      例如, `v-bind` 指令可以用于响应式地更新 HTML attribute:
      ```html
        <a v-bind:href="url">...</a>
      ```
      在这里 `href` 就是参数, 告知 `v-bind` 指令将该元素的 `href`属性
      与表达式 `url` 的值绑定.
    + 另一个例子是 `v-on` 指令, 它用于监听 DOM 事件:
      ```html
        <a v-on:click="doSomething">...</a>
      ```
      在这里参数是监听的事件名. 我们在后面也会更详细地讨论事件处理.
- 1.4.2.2 动态参数
    + > 2.6.0 新增
    + 从 2.6.0 开始, 可以用方括号括起来的 JavaScript 表达式作为一个指令的参数:
      ```vue
        <!-- 注意, 参数表达式的写法存在一些约束, 如下面的要讲的
          "对动态参数表达式的约束" 中所述.-->
        <a v-bind:[attributeName]="url">...</a>
      ```
      这里的 `attributeName` 会被作为一个 JavaScript 表达式进行动态求值,
      求得的值将会作为最终的参数来使用. 例如, 如果你的 Vue 实例有个 `data`
      属性 `attributeName`, 其值为 `href`, 那么这个绑定将等价于 `v-bind:href`.

      同样地, 你可以使用动态参数为一个动态的事件名绑定处理函数:
      ```vue
        <a v-on:[eventName]="doSomething">...</a>
      ```
      在这个示例中, 如果 `eventName` 的值为 `focus`, `v-on:[eventName]`
      就等价于 `v-on:focus`.
    + **动态参数`值`约束**:
      
      动态参数预期会求出一个字符串, 异常情况下值为 `null` 这个特殊的 `null`
      值可以被显性地用于移除绑定. 任何其它非字符串类型的值都将会触发一个警告.
    + **动态参数`表达式`约束**:
      
      动态参数表达式有一些语法约束, 因为某些字符, 如`空格`和`引号`, 放在 HTML
      属性(attribute) 名里是无效的. 例如:
      ```html
        <!-- 这会触发一个编译警告 -->
        <a v-bind:['foo' + bar]="value">...</a>
      ```
      变通的方法是使用没有空格或引号的的表达式, 或用计算属性替代这些复杂表达式.

      在 DOM 中使用模板时 (直接在一个 HTML 文件里撰写模板),
      还需要避免使用大写字符来命名键名, 因为浏览器会把 attribute
      名全部强制转换为小写:
      ```vue
        <!-- 在 DOM 中使用模板时这段代码会被转换为 `v-bind:[someattr]`.
        除非在实例中有一个名为 `someattr` 的 property, 否则代码不会工作. -->
        <a v-bind:[someAttr]="value">...</a>
      ```
    
- 1.4.2.3 修饰符
    + `修饰符(modifier)` 是以半角句号 `.` 指明的特殊后缀,
      用于指出一个指令应该以特殊方式绑定. 例如: `.prevent` 修饰符告诉 `v-on`
      指令对于触发的事件调用 `event.preventDefault()`(取消事件的默认行为):
      ```vue
        <form v-on:submit.prevent="onSubmit">...</form>
      ```
      在接下来对 `v-on` 和 `v-for` 等功能的探索中, 你会看到修饰符的其他例子.

##### 1.4.3 缩写
- `v-` 前缀作为一种视觉提示, 用来识别模板中 Vue 特定的 属性(attribute).
  当你在使用 Vue.js 为现有标签添加 动态行为(dynamic behavior) 时, `v-`
  前缀很有帮助, 然而, 对于一些频繁用到的指令来说, 就会感到使用繁琐. 同时,
  在构建由 Vue 管理所有模板的
  [单页面应用程序](https://www.wikiwand.com/en/Single-page_application)
  (`SPA - single page application`)时, `v-` 前缀也变得没那么重要了.
  因此, Vue 为 `v-bind` 和 `v-on` 这两个最常用的指令, 提供了特定简写:
- 1.4.3.1 `v-bind` 缩写
  ```html
    <!-- 完整语法 -->
    <a v-bind:href="url">...</a>
    
    <!-- 缩写 -->
    <a :href="url">...</a>

    <!-- 动态查宿的缩写 (2.6.0+) -->
    <a :[key]="url">...</a>
  ```
- 1.4.3.2 `v-on` 缩写
  ```html
    <!-- 完整语法 -->
    <a v-on:click="doSomething">...</a>
    
    <!-- 缩写 -->
    <a @click="doSomething">...</a>

    <!-- 动态查宿的缩写 (2.6.0+) -->
    <a @[event]="doSomething">...</a>
  ```
 
  它们看起来可能与普通的 HTML 略有不同, 但 `:` 与 `@` 对于 attribute
  名来说都是合法字符, 在所有支持 Vue 的浏览器都能被正确地解析。而且, 
  它们不会出现在最终渲染的标记中。缩写语法是完全可选的, 
  但随着你更深入地了解它们的作用, 你会庆幸拥有它们. 