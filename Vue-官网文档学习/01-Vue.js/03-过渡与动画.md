# 03 过渡 & 动画


## 目录(Catalog)
* 3.1 进入/离开 & 列表过渡
    - 3.1.1 概述
    - 3.1.2 单元素/组件的过渡
        + 3.1.2.1 过渡的类名 
        + 3.1.2.2 CSS 过渡
        + 3.1.2.3 CSS 动画
        + 3.1.2.4 自定义过渡的类名
        + 3.1.2.5 同时使用过渡与动画
        + 3.1.2.6 显性的过渡持续时间
        + 3.1.2.7 JavaScript 钩子 
    - 3.1.3 初始渲染的过渡
    - 3.1.4 多个元素的过渡
        + 3.1.4.1 过渡模式
    - 3.1.6 多个组件的过渡
    - 3.1.7 列表过渡
        + 3.1.7.1 列表的进入/离开过渡 
        + 3.1.7.2 列表的排序过渡
        + 3.1.7.3 列表的交错过渡
    - 3.1.8 可复用的过渡
    - 3.1.9 动态过渡
* 3.2 状态过渡
    - 3.2.1 状态动画与侦听器
    - 3.2.2 动态状态过渡
    - 3.2.3 把过渡放到组件里
    - 3.2.4 赋予设计以生命


## 生词(New Words)
- **interpret [ɪn'tɝprɪt] --vt.解释,说明; 解析. --vi.口译**
    + Can you interpret(vt) the passage? 你能解释这一段吗?
    + How do you interpret(vt) this sentence? 你如何解释这一句?
    + He interpreted(vt) those symbols for me. 他为我解说那些符号.
    + The student kindly interpreted(vi) for me. 那个学生亲切地为我口译.
- **interpretation [ɪntɜːprɪ'teɪʃ(ə)n] --n.解释, 翻译**
    + semantic interpretation rule. 语义解释规则. 
    + They put a false interpretation on events. 它们对事件进行了错误的解释. 
    + Everything is your mind, or interpretation of your mind.
        所有事都是你的心, 或者是你心的解释. 
- **transition [træn'zɪʃən] --n.过渡; 转换; 变迁**
    + transition animation. 过渡动画
    + transition duration. 过渡时间
    + a period of transition. 过渡时期
    + Adolescence is the period of transition between childhood and
      adulthood. 青春期是童年与成年之间的过渡时期.
- **reverse [rɪ'vɜːs] --adj.相反的. --v.逆转, 颠倒. --n.相反, 背面**
    + Reverse Proxy 反向代理, 逆向代理
    + We should see the reverse as well as the obverse of things.
      我们应该看到事物的反面和正面. 
- **alternate ['ɔːltəneɪt] --adj.轮流的; 交替的; 间隔的. vt&vi.轮流; 交替**
    + That was a week of alternate(adj) rain and sunshine.
      那是晴雨天交替的一周.
    + Alternate(adj) hop and fear. 时喜时忧.


## 内容(Content)

### 0.0 前置知识
- (1) CSS3 过渡(transition), 转换(transform)和动画(animation) 的知识见仓库文件: <br>
  [CSS-grocery/CSS3-过渡-转换-动画/transition-transform-animation.md](File:///Users/WANG/Github-clone/CSS-grocery/CSS3-过渡-转换-动画/transition-transform-animation.md)
- (2) ==**Important**==: 使用原生 JS 来简单实现 Vue 过渡效果的示例: <br>
  [JS-book-learning/《JavaScript高级程序设计》/Chapter11-DOM扩展/JS添加和删除class方法总结.md](File:///Users/WANG/Github-clone/JS-book-learning/《JavaScript高级程序设计》/Chapter11-DOM扩展/JS添加和删除class方法总结.md)
  内的 `1.5 使用 JS 控制 transition(过渡)效果`

  如果你不熟悉原生 JS 如何操作 CSS3 的 transition 过渡样式, 请一定要先看一下这个示例.


### 3.1 进入/离开 & 列表过渡
##### 3.1.1 概述
- 当我们在 DOM 中插入, 更新或移除选项(items)时, Vue 提供了多种方式去应用
  transition(过渡)效果. 这包括用于: 
    + (1) 自动应用 class 在过渡(transition)和动画(animation) 中
    + (2) 可以配合使用第三方 CSS 动画库, 如 Animate.css
    + (3) 在过渡钩子函数中使用 JavaScript 直接操作 DOM
    + (4) 可以配合使用第三方 JavaScript 动画库, 如 Velocity.js
  
  在这里, 我们只会讲到进入、离开和列表的过渡, 你也可以看下一节的
  `管理过渡状态`(`3.2 状态过渡`).
##### 3.1.2 单元素/组件的过渡
- Vue 提供了 `transition(过渡)` 的封装组件, 在下列情形中,
  可以给任何元素和组件添加进入/离开过渡.
    + (1) 条件渲染 (使用 `v-if`) 
    + (2) 条件展示 (使用 `v-show`)
    + (3) 动态组件
    + (4) 组件根节点
  
  这是一个典型的例子:
  ```vue
    <template>
        <div class="default-div">
            <h2>3.1.2 单元素/组件的过渡</h2>
            <div id="demo">
                <button @click="show = !show">Toggle</button>
                <transition name="fade">
                    <p v-if="show">Hello</p>
                </transition>
            </div>
        </div>
    </template>
    <script>
        export default {
            name: 'Demo312',
            data() {
                return {
                    show: true
                }
            }
        }
    </script>
    <style scoped>
        /* - transition 会自动监听元素从起始状态到终止状态的过渡, 我们不用管中间状态.
         *   对应此示例, 起始状态到终止状态的过渡有 2 种情形: 细节讲解参考:
         *   0.0 前置知识 - (2) 使用原生 JS 来简单实现 Vue 过渡效果的示例:
         */
        .fade-enter-active, .fade-leave-active {
            transition: opacity .5s;
        }
        .fade-enter, .fade-leave-to {
            opacity: 0;
        }
    </style>
  ```
  当插入或删除包含在 `transition` 组件中的元素时, Vue 将会做以下处理:
    + (1) 自动嗅探目标元素是否应用了 CSS 过渡或动画, 如果是, 在恰当的时机添加删除
      CSS 类名.
    + (2) 如果过渡组件提供了 `JavaScript 钩子函数`(下面
      `3.1.2.7 JavaScript 钩子`), 这些钩子函数将在恰当的时机被调用.
    + (3) 如果没有找到 JavaScript 钩子并且也没有检测到 CSS 过渡/动画, DOM 操作
      (插入/删除) 在下一帧中立即执行. (注意: 此指浏览器逐帧动画机制, 和 Vue 的
      `nextTick` 概念不同.)
- **3.1.2.1 过渡的类名**

  在元素 进入(enter)/离开(leave) 的过渡(transition)中, 有 6 个 class 被应用:
    + (1) `v-enter`: 定义进入过渡的开始状态. 在元素被插入到 DOM 之前添加,
      在元素被插入之后的下一帧移除.
    + (2) `v-enter-active`: 元素进入过渡(transition)时被激活,
      应用在整个进入状态. 在元素插入 DOM 的那一刻即被添加,
      过渡(transition) / 动画(animation) 完成之后被移除.
      这个类可以也可以用来定义进入过渡的过渡持续时间(transition-duration),
      过渡时间的曲线函数(transition-timing-function)
      以及延迟过渡(transition-delay). (tip: 这里的知识, 在上面的 **前置知识**
      中有详细的讲解).
    + (3) `v-enter-to`: **2.1.8 版本及以上** 定义进入过渡的结束状态.
      在元素被插入之后下一帧生效(与此同时 `v-enter` 被移除), 在 transition(过渡)
      / 动画(animation) 完成之后移除.
    + (4) `v-leave`: 定义离开过渡(leave transition) 的开始状态.
      在离开过渡被触发时立刻生效, 下一帧被移除.
    + (5) `v-leave-active`: 定义离开过渡生效时的状态. 在真个离开过渡的阶段中应用,
      在离开过渡被触发时立即生效, 在过渡/动画完成之后移除.
      这个类同样可以也可以用来定义进入过渡的过渡持续时间(transition-duration),
      过渡时间的曲线函数(transition-timing-function)
      以及延迟过渡(transition-delay).
    + (6) `v-leave-to`: **2.1.8 版及以上** 定义离开过渡的结束状态.
      在离开过渡被触发之后下一帧生效(与此同时 `v-leave` 被删除),
      在过渡/动画完成之后移除.

  <img src="./vue-document-images/transition.png"
        style="margin-left: 0; border-radius: 4px;
          box-shadow: 1px 1px 3px 2px #e5e5e5">
  
  对于这些在过渡中切换的类名来说, 如果你使用一个没有名字的 `<transition>`, 则 `v-`
  是这些类名的默认前缀. 如果你使用了 `<transition name="my-transition">`,
  那么 `v-enter` 会替换为 `my-transition-enter`.

  `v-enter-active` 和 `v-leave-active` 可以控制 进入/离开 过渡的不同的缓和曲线,
  在下面章节会有个示例说明.
  
- **3.1.2.2 CSS 过渡**
    + 常用的过渡都是使用 CSS 过渡. 下面是一个简单例子.
      ```vue
       <template>
            <div class="default-div">
                <h2>3.1.2.2 CSS 过渡</h2>
                <div id="demo">
                    <button @click="show = !show">Toggle render</button>
                    <transition name="slide-fade">
                        <p v-if="show">CSS transition(过渡)</p>
                    </transition>
                </div>
            </div>
        </template>

        <script>
            export default {
                name: 'Demo3122',
                data() {
                    return {
                        show: true
                    }
                }
            }
        </script>

        <style scoped>
            /* - 可以设置不同的进入和离开动画 */
            /* - 设置持续时间和动画函数 */
            .slide-fade-enter-active {
                transition: all .6s linear;
            }
            .slide-fade-leave-active {
                transition: all .6s cubic-bezier(1.0, 0.5, 0.8, 1.0);
            }
            .slide-fade-enter, .slide-fade-leave-to {
                transform: translateX(10px);
                opacity: 0;
            }
        </style>
      ```
- **3.1.2.3 CSS 动画**
    + CSS 动画用法同 CSS 过渡, 区别是在动画中 `v-enter` 类名在节点插入 DOM
      后不会立即删除, 而是在 `animationend` 事件触发时删除.

      示例: (省略了兼容性前缀)
      ```vue
        <template>
            <div class="default-div">
                <h2>3.1.2.3 CSS 动画</h2>
                <div id="demo">
                    <button @click="show = !show">Toggle show</button>
                    <transition name="bounce">
                        <p v-if="show" class="text-center">
                            CSS animation(动画): <br>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elt.
                        </p>
                    </transition>
                </div>
            </div>
        </template>
        <script>
            export default {
                name: 'Demo3123',
                data() {
                    return {
                        show: true
                    }
                }
            }
        </script>
        <style scoped>
            .text-center {
                text-align: center;
            }
            .bounce-enter-active {
                animation: bounce-in .5s;
            }
            .bounce-leave-active {
                /* - animation-direction 让动画按照指定顺序来播放 `@keyframes` 定义的关键帧.
                *   其值有:
                * - (1) `normal` 默认值.
                * - (2) `reverse` 表示动画反向播放.
                * - (3) `alternate` 表示正向和反向交叉进行.
                * - (4) `alternate-reverse` 表示反向和正向交叉进行. */
                animation: bounce-in .5s reverse;
            }
            @keyframes bounce-in {
                0% { transform: scale(0); }
                50% { transform: scale(1.5); }
                100% { transform: scale(1); }
            }
        </style>
      ```
- **3.1.2.4 自定义过渡的类名**
    + 我们可以通过以下 特性(attribute) 来自定义过渡类名:
        - (1) `enter-class`
        - (2) `enter-active-class`
        - (3) `enter-to-class` (2.1.8+)
        - (4) `leave-class`
        - (5) `leave-active-class`
        - (6) `leave-to-class` (2.1.8+)
        
        
      
      这些将覆盖常规的(conventional)的类名, 当你想把 Vue 的过渡系统与已经存在的
      CSS 动画(animation) 库相连接时这特别有用, 例如
      [Animate.css](https://daneden.github.io/animate.css/)
      
      示例:
      ```vue
        <!-- Tip: 使用命令行在项目中安装 animate.css
             `npm install --save animate.css` 或者 `yarn add animate.css`
        -->
        <template>
            <div class="default-div">
                <h2>3.1.2.4 自定义过渡的类名</h2>
                <div id="Demo3124">
                    <button @click="show = !show">Toggle show</button>
                    <transition
                        name="custom-classes-transition"
                        enter-active-class="animated tada"
                        leave-active-class="animated bounceOutRight"
                        >
                        <p v-if="show">
                            自定义过渡类名
                        </p>
                    </transition>
                </div>
            </div>
        </template>
        <script>
            // - 引入 animate.css
            import animate from 'animate.css'
            export default {
                name: 'Demo3124',
                data() {
                    return {
                        show: true
                    }
                }
            }
        </script>
      ```
- **3.1.2.5 同时使用过渡与动画**
    + Vue 为了知道过渡的完成, 必须设置相应的事件监听器, 它可以是 `transitionend`
      或 `animationend`, 这取决于给元素应用的 CSS 规则. 如果你使用其中任何一种,
      Vue 能自动识别类型并设置监听.

      但是, 在一些场景中, 你需要给同一个元素同时设置 2 种过渡动效, 比如 `animation`
      很快的被触发并完成了, 而 `transition` 效果还没结束. 在这种情况下, 你需要使用
      `type` 特性(attribute) 并设置 `animation` 或 `transition`
      来明确声明你需要 Vue 监听的类型.

- **3.1.2.6 显性的过渡持续时间**
    + <p style="color: green">2.2.0 新增</p>
    + 在很多情况下, Vue 可以自动得出过渡效果的完成时机. 默认情况下,
      Vue 会等待根过渡(transition)元素上的第一个 `transitionend` 或
      `animationend` 事件. 然而也可以不这样设定 -- 比如,
      我们可以拥有一个精心编排的一系列过渡效果,
      其中一些嵌套的内部元素相比于过渡效果的根元素有延迟的或更长的过渡效果.

      在这种情况下你可以用 `<transition>` 组件上的 `duration`
      属性定制一个显性的过渡持续时间(以毫秒计): 
      ```html
        <transition v-bind:duration="1000">...</transition>
      ```
      你也可以定制进入和移出的持续时间:
      ```html
        <transition :duration="{enter: 500, leave: 800}">...</transition>
      ```

- **3.1.2.7 JavaScript 钩子**
    + 可以在属性中声明 JavaScript 钩子
      ```html
        <!-- enter cancelled 进入取消  -->
        <transition
            v-on:before-enter="beforeEnter"
            @enter="enter"
            @after-enter="afterEnter"
            @enter-cancelled="enterCancelled"

            @before-leave="beforeLeave"
            @leave="leave"
            @after-leave="afterLeave"
            @leave-cancelled="leaveCancelled"
        >
        <!-- ... -->
        </transition>
      ```
      ```js
        methods: {
            /* - 进入中 */
            beforeEnter: function(el) {
                // ...
            },
            // - 当与 CSS 结合使用时, 回调函数 done 是可选的
            enter: function(el, done) {
                // ...
                done()
            },
            afterEnter: function(el) {
                // ...
            },
            enterCancelled: function(el) {
                // ...
            },

            /* - 离开时 */
            beforeLeave: function(el) {
                // ...
            },
            // - 当与 CSS 结合使用时, 回调函数 done 是可选的
            leave: function(el, done) {
                // ...
                done()
            },
            afterLeave: function(el) {
                // ...
            },
            // - leaveCancelled 只用于 v-show 中
            leaveCancelled: function(el) {
                // ...
            }
        }
      ```
      这些钩子函数可以结合 CSS `transition`/`animation` 使用, 也可以单独使用.

      **Warning**: 当使用 JavaScript 过渡的时候, 在 `enter` 和 `leave`
      中必须使用 `done` 进行回调. 否则, 它们将被同步回调, 过渡会立即完成.

      **Warning**: 推荐对于仅使用 JavaScript 过渡的元素添加
      `v-bind:css="false"`, Vue 会跳过 CSS 的检测.
      这也可以避免过渡过程中 CSS 的影响.

      一个使用 `Velocity.js` 的简单例子:
      ```vue
        <!-- NPM 安装: `npm install velocity-animate@beta -->
        <!-- Velocity 和 jQuery.animate 的工作方式类似, 也是用来实现
             JavaScript 动画的一个很棒的选择 -->
        <template>
            <div class="default-div">
                <h2>3.1.2.7 JavaScript 钩子</h2>
                <div id="Demo3127">
                    <button @click="show = !show">Toggle use Velocity.js</button>
                    <transition
                        v-on:before-enter="beforeEnter"
                        v-on:enter="enter"
                        v-on:leave="leave"
                        v-bind:css="false"
                    >
                        <p v-if="show">
                        animation effects.
                        </p>
                    </transition>
                </div>
            </div>
        </template>
        <script>
            import Velocity from 'velocity-animate'
            export default {
                name: 'Demo3127',
                data() {
                    return {
                        show: false
                    }
                },
                methods: {
                    beforeEnter: function(el) {
                        el.style.opacity = 0;
                        el.style.transformOrigin = 'left';
                    },
                    enter: function(el, done) {
                        Velocity(el, {opacity: 1, fontSize: '1.4em'}, {duration: 300});
                        Velocity(el, {fontSize: '1em'}, {complete: done});
                    },
                    /* - Notice: 离开的效果在当前组件中死活改不对, 方了!!! */
                    leave: function(el, done) {
                        Velocity(el, {translateX: '15px', rotateZ: '50deg'}, {duration: 600});
                        Velocity(el, {rotateZ: '100deg'}, {loop: 2});
                        Velocity(el, {
                            rotateZ: '45deg',
                            translateY: '30px',
                            translateX: '30px',
                            opacity: 0
                        }, {complete: done})
                    }
                }
            }
        </script>
        <style scoped>
            #Demo3127 {
                height: 160px;
                width: 76%;
                margin: 0 auto;
                background: lightgray;
                border-radius: 4px;
                text-align: center;
                overflow: auto;
                position: relative;
            }
        </style>
      ```

##### 3.1.3 初始渲染的过渡
- 可以通过 `appear` 特性(attribute) 设置节点在初始渲染的过渡
  ```html
    <transition appear>
        <!-- ... -->
    </transition>
  ```
  这里默认和进入/离开过渡一样, 同样也可以自定义 CSS 类名.
  ```html
    <transition
        appear
        appear-class="custom-appear-class"
        appear-to-class="custom-appear-to-class"
        appear-active-class="custom-appear-active-class"
    >
        <!-- ... -->
    </transition>
  ```
  自定义 JavaScript 钩子:
  ```html
    <transition
        appear
        @before-appear="customBeforeAppearHook"
        @appear="customAppearHook"
        @after-appear="customAfterAppearHook"
        @appear-cancelled="customAppearCancelledHook"
    >
        <!-- ... -->
    </transition>
  ```
  在上面的例子中, 无论是 `appear` 特性(attribute) 还是 `v-on:appear`
  钩子都会生成初始渲染过渡.
##### 3.1.4 多个元素的过渡
- 我们之后讨论 多个组件的过渡(下一节), 对于原生标签可以使用 `v-if`/`v-else`.
  最常见的多标签过渡是一个列表和描述这个列表为空消息的元素:
  ```html
    <transition>
        <table v-if="items.length > 0">
            <!-- ... -->
        </table>
        <p v-else>Sorry, no items found.</p>
    </transition>
  ```
  可以这么使用, 但是有一点要注意:

  **Warning:** 当有**相同标签名**的元素切换时, 需要通过 `key` 特性(attribute)
  设置唯一的值来标记以让 Vue 区分它们, 否则 Vue 为了效率只会替换相同标签内部的内容.
  即使在技术上没有必要, **给在 `<transition>` 组件中的多个元素设置 key
  是一个更好的实践**.

  示例:
  ```html
    <transition>
        <button v-if="isEditing" key="save">Save</button>
        <button v-else key="edit">Edit</button>
    </transition>
  ```
  在一些场景中, 也可以通过给同一个元素的 `key` 特性(attribute) 设置不同的状态来代替
  `v-if` 和 `v-else`, 上面的例子可以重写为:
  ```html
    <transition>
        <button v-if="isEditing">
            {{ isEditing ? 'Save' : 'Edit' }}
        </button>
    </transition>
  ```
  这里添加一个单文件组件的示例:
  ```vue
    <template>
        <div class="default-div">
            <h2>3.1.4 多个元素的过渡</h2>
            <div id="demo">
                <button @click="changeFun">Change button</button>
                <br>
                <transition name="change-button">
                    <button :key="change">
                        {{ change ? 'Edit' : 'Save' }}
                    </button>
                </transition>
            </div>
        </div>
    </template>
    <script>
        export default {
            name: 'Demo314',
            data() {
                return {
                    change: true,
                }
            },
            methods: {
                changeFun: function() {
                    if (this.change === true) {
                        this.change = false;
                        return;
                    }
                    if (this.change === false) {
                        this.change = true;
                    }
                }
            }
        }
    </script>
    <style scoped>
        .change-button-enter-active, .change-button-leave-active {
            transition: all .6s linear;
        }
        .change-button-enter, .change-button-leave-to {
            transform: translateX(10px);
            opacity: 0;
        }
    </style>
  ```
  使用多个 `v-if` 的多个元素的过渡可以重写为绑定了动态属性的单个元素过渡. 例如:
  ```html
    <transition>
        <button v-if="docState === 'saved'" kye="saved">Edit</button>
        <button v-if="docState === 'edited'" kye="edited">Save</button>
        <button v-if="docState === 'editing'" kye="editing">Cancel</button>
    </transition>
  ```
  可以重写为: 
  ```html
    <transition>
        <button v-bind:key="docState">{{ buttonMessage }}</button>
    </transition>
  ```
- 3.1.4.1 过渡模式
##### 3.1.6 多个组件的过渡
##### 3.1.7 列表过渡
- 3.1.7.1 列表的进入/离开过渡 
- 3.1.7.2 列表的排序过渡
- 3.1.7.3 列表的交错过渡
##### 3.1.8 可复用的过渡
##### 3.1.9 动态过渡
